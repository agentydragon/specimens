rationale: |
  A ~30-line sequence (generate diff, build permission.CreatePermissionRequest, write file, history bookkeeping,
  recordFileWrite/read) is duplicated across multiple branches in internal/llm/tools/edit.go. Extract a single
  helper
  parameterized by action, description, and params to centralize permission, diff, write, history bookkeeping
  and avoid
  drift.
should_flag: true
occurrences:
- occurrence_id: occ-0
  files:
    internal/llm/tools/edit.go:
    - 226
    - 275
  note: 'createNewFile branch: diff+permission+write+history+record bookkeeping.'
  expect_caught_from:
  - - internal/llm/tools/edit.go
- occurrence_id: occ-1
  files:
    internal/llm/tools/edit.go:
    - 349
    - 406
  note: 'deleteContent branch: diff+permission+write+history+record bookkeeping (similar pattern).'
  expect_caught_from:
  - - internal/llm/tools/edit.go
- occurrence_id: occ-2
  files:
    internal/llm/tools/edit.go:
    - 488
    - 550
  note: |-
    replaceContent branch: same sequence; extract helper EnsureWriteWithHistory(ctx, files, sessionID, filePath,
    oldContent, newContent, action, desc, params...).
  expect_caught_from:
  - - internal/llm/tools/edit.go
