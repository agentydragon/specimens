#!/usr/bin/env bash
set -euo pipefail

# Deny pushes to refs/for/* (AGit flow PR creation).
# Install as:
#   - Global:   /var/lib/gitea/custom/hooks/pre-receive.d/deny-refs-for (chmod 0755)
#   - Per-repo: <repo>.git/hooks/pre-receive.d/deny-refs-for (chmod 0755)

blocked=0
while read -r old new ref; do
  if [[ "${ref}" == refs/for/* ]]; then
    echo "PR creation via AGit flow (refs/for/*) is disabled: ${ref}" >&2
    blocked=1
  fi
done

exit ${blocked}
