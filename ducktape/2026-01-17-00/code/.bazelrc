common --progress_in_terminal_title

# TODO: configure Bazel cache once it's set up, e.g. via try-import

common --enable_bzlmod

# Lint configuration (Python ruff + JS/TS eslint)
# Run with: bazel build --config=lint //...
build:lint --aspects=//tools/lint:linters.bzl%ruff,//tools/lint:linters.bzl%eslint
build:lint --output_groups=+rules_lint_report

# Type checking configuration
# Run with: bazel build --config=typecheck //...
# Use Python 3.13 for mypy to parse Python 3.13 syntax (e.g., homeassistant)
build:typecheck --@rules_python//python/config_settings:python_version=3.13
build:typecheck --aspects=//tools/lint:linters.bzl%mypy_aspect
build:typecheck --output_groups=+mypy

# Combined lint + typecheck
# Run with: bazel build --config=check //...
# Use Python 3.13 for mypy to parse Python 3.13 syntax (e.g., homeassistant)
build:check --@rules_python//python/config_settings:python_version=3.13
build:check --aspects=//tools/lint:linters.bzl%ruff,//tools/lint:linters.bzl%mypy_aspect
build:check --output_groups=+rules_lint_report,+mypy

# Rust linting (clippy)
# Run with: bazel build --config=clippy //finance/worthy:all
build:clippy --aspects=@rules_rust//rust:defs.bzl%rust_clippy_aspect
build:clippy --output_groups=+clippy_checks

# Rust formatting check
# Run with: bazel build --config=rustfmt //finance/worthy:all
build:rustfmt --aspects=@rules_rust//rust:defs.bzl%rustfmt_aspect
build:rustfmt --output_groups=+rustfmt_checks

# Combined Rust lint + format
# Run with: bazel build --config=rust-check //finance/worthy:all
build:rust-check --aspects=@rules_rust//rust:defs.bzl%rust_clippy_aspect,@rules_rust//rust:defs.bzl%rustfmt_aspect
build:rust-check --output_groups=+clippy_checks,+rustfmt_checks

# ESLint only (for JS/TS without Python)
# Run with: bazel build --config=eslint //props/frontend:all
build:eslint --aspects=//tools/lint:linters.bzl%eslint
build:eslint --output_groups=+rules_lint_report

# Formatting: use bazel run //tools/format (fix) or //tools/format.check (check)
# Supports: prettier (JS/TS/CSS/HTML/MD), ruff (Python), shfmt (Shell), buildifier (Bazel), rustfmt (Rust)

# CI profiling - captures performance data for every build
# Run with: bazel build --config=ci-profile //...
# Produces: bazel-profile.gz (Chrome tracing format), execution-log.json (action-level timing)
build:ci-profile --profile=bazel-profile.gz
build:ci-profile --execution_log_json_file=execution-log.json
