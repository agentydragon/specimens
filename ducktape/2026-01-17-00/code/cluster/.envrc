# Inherit repo root environment (pre-commit, markdownlint-cli2, etc.)
source_up

# Use shell.nix for cluster-specific tools (kubeseal, talosctl, etc.)
use nix

# Hetzner Cloud API token (stored in libsecret)
# Store with: echo -n "your-token" | secret-tool store --label='Hetzner Cloud API' service hcloud account default
# HCLOUD_TOKEN for CLI tools (hcloud)
# TF_VAR_hcloud_token for terraform provider
export HCLOUD_TOKEN=$(secret-tool lookup service hcloud account default 2>/dev/null)
export TF_VAR_hcloud_token="$HCLOUD_TOKEN"

# Set talos config and kubeconfig (generated by terraform)
export TALOSCONFIG="$PWD/terraform/01-infrastructure/talosconfig.yml"
export KUBECONFIG="$PWD/terraform/01-infrastructure/kubeconfig"
# kubeseal configured to use standard defaults (kube-system namespace)

cat <<'EOF'
ðŸš€ Talos Kubernetes Cluster Environment
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Authentik: https://auth.test-cluster.agentydragon.com

get-passwords  - Retrieve Authentik passwords (akadmin & agentydragon@gmail.com)
EOF

# Add scripts directory to PATH
PATH_add scripts
