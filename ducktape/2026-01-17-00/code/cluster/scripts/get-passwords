#!/usr/bin/env bash
set -euo pipefail

# Retrieve Authentik passwords from Kubernetes secrets
# Usage: get-passwords

echo "=== Authentik Passwords ==="
echo ""

# Get admin bootstrap password
ADMIN_PASSWORD=$(kubectl get secret -n authentik authentik-admin-password \
	-o jsonpath='{.data.AUTHENTIK_BOOTSTRAP_PASSWORD}' 2>/dev/null | base64 -d)

if [ -n "$ADMIN_PASSWORD" ] && [ "$ADMIN_PASSWORD" != "null" ]; then
	echo "Admin (akadmin):           $ADMIN_PASSWORD"
else
	echo "Admin (akadmin):           [ERROR: Could not retrieve]" >&2
fi

# Get agentydragon user password
USER_PASSWORD=$(kubectl get secret -n flux-system agentydragon-user-password \
	-o jsonpath='{.data.user_password}' 2>/dev/null | base64 -d)

if [ -n "$USER_PASSWORD" ] && [ "$USER_PASSWORD" != "null" ]; then
	echo "User (agentydragon@gmail.com): $USER_PASSWORD"
else
	echo "User (agentydragon@gmail.com): [ERROR: Could not retrieve]" >&2
fi

echo ""
