load("@rules_python//python:defs.bzl", "py_binary", "py_library", "py_test")

py_library(
    name = "claude_linter_v2",
    srcs = [
        "__init__.py",
        "access/__init__.py",
        "access/context.py",
        "access/evaluator.py",
        "access/rule_engine.py",
        "check_python.py",
        "checker.py",
        "checkers_v2.py",
        "cli.py",
        "config/__init__.py",
        "config/clean_models.py",
        "config/loader.py",
        "config/models.py",
        "diff/__init__.py",
        "diff/categorizer.py",
        "diff/intelligence.py",
        "diff/parser.py",
        "hooks/__init__.py",
        "hooks/exceptions.py",
        "hooks/formatting.py",
        "hooks/handler.py",
        "hooks/validation.py",
        "linters/__init__.py",
        "linters/python_ast.py",
        "linters/python_formatter.py",
        "linters/python_ruff.py",
        "llm_analyzer.py",
        "notifications.py",
        "pattern_matcher.py",
        "rule_registry.py",
        "session/__init__.py",
        "session/manager.py",
        "session/state.py",
        "session/violations.py",
        "types.py",
        "utils/__init__.py",
        "utils/gitignore.py",
    ],
    imports = ["../.."],
    visibility = ["//visibility:public"],
    deps = [
        "//llm/ducktape_llm_common:core",
        "@pypi//click",
        "@pypi//humanize",
        "@pypi//platformdirs",
        "@pypi//pydantic",
        "@pypi//pygit2",
        "@pypi//pytimeparse",
        "@pypi//pyyaml",
        "@pypi//ruff",
        "@pypi//tomli",
        "@pypi//tomli_w",
    ],
)

py_binary(
    name = "claude-linter-v2",
    srcs = ["cli.py"],
    main = "cli.py",
    deps = [":claude_linter_v2"],
)

py_test(
    name = "test_claude_linter_v2",
    srcs = [
        "conftest.py",
        "test_cl2_check.py",
        "test_diff_intelligence.py",
        "test_diff_intelligence_edge_cases.py",
        "test_integration.py",
        "test_mcp_tools.py",
        "test_modular_config.py",
        "test_multiline_predicates.py",
        "test_python_ast.py",
        "test_python_formatter.py",
        "test_python_ruff.py",
        "test_stop_hook_fresh_scan.py",
        "test_stop_hook_gitignore.py",
        "test_stop_hook_quality_gate.py",
    ],
    main = "test_integration.py",
    deps = [
        ":claude_linter_v2",
        "@pypi//click",
        "@pypi//pytest",
    ],
)
