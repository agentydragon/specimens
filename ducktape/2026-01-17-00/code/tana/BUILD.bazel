load("@rules_python//python:defs.bzl", "py_binary", "py_library", "py_test")
load("//tools/lint:linters.bzl", "ruff_test")

py_library(
    name = "tana",
    srcs = [
        "domain/constants.py",
        "domain/nodes.py",
        "domain/search.py",
        "domain/types.py",
        "export/cli.py",
        "export/convert.py",
        "export/export_node_subset.py",
        "export/headless_autoexport/record_from_profile.py",
        "export/materialize_searches.py",
        "export/sample.py",
        "export/tana_issues_to_tanapaste.py",
        "graph/workspace.py",
        "graph/wrappers.py",
        "io/json.py",
        "query/core.py",
        "query/filters.py",
        "query/nodes.py",
        "query/search/evaluator.py",
        "query/search/materializer.py",
        "query/search/parser.py",
        "render/html.py",
        "render/inline_refs.py",
        "workspace.py",
    ],
    imports = [".."],
    visibility = ["//visibility:public"],
    deps = [
        "@pypi//playwright",
        "@pypi//pydantic",
    ],
)

py_binary(
    name = "tana-export",
    srcs = ["export/cli.py"],
    imports = [".."],
    main = "export/cli.py",
    deps = [":tana"],
)

py_binary(
    name = "tana-export-convert",
    srcs = ["export/convert.py"],
    imports = [".."],
    main = "export/convert.py",
    deps = [":tana"],
)

py_binary(
    name = "tana-export-searches",
    srcs = ["export/materialize_searches.py"],
    imports = [".."],
    main = "export/materialize_searches.py",
    deps = [":tana"],
)

py_binary(
    name = "tana-export-issues",
    srcs = ["export/tana_issues_to_tanapaste.py"],
    imports = [".."],
    main = "export/tana_issues_to_tanapaste.py",
    deps = [":tana"],
)

py_test(
    name = "test_tana",
    srcs = ["test_convert.py"],
    data = glob(["testdata/**/*"]),
    imports = [".."],
    main = "test_convert.py",
    deps = [
        ":tana",
        "@pypi//pytest",
        "@pypi//pytest_asyncio",
    ],
)

ruff_test(
    name = "ruff",
    srcs = [":tana"],
)
