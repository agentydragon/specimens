# gazelle:ignore
load("@rules_python//python:defs.bzl", "py_binary", "py_library", "py_test")

# NOTE: No aggregator target - use specific per-file targets like :actions, :base, etc.
# This is the Gazelle-compatible pattern (python_generation_mode = file)

# =============================================================================
# Library targets (per-file)
# =============================================================================

py_library(
    name = "actions",
    srcs = ["actions.py"],
    imports = [".."],
    deps = ["@pypi//typing_extensions"],
)

py_library(
    name = "config",
    srcs = ["config.py"],
    imports = [".."],
    deps = ["@pypi//pydantic"],
)

py_library(
    name = "tool_models",
    srcs = ["tool_models.py"],
    imports = [".."],
    deps = ["@pypi//pydantic"],
)

py_library(
    name = "logging_context",
    srcs = ["logging_context.py"],
    imports = [".."],
)

py_library(
    name = "inputs",
    srcs = ["inputs.py"],
    imports = [".."],
    deps = [
        ":tool_models",
        "@pypi//pydantic",
    ],
)

py_library(
    name = "base",
    srcs = ["base.py"],
    imports = [".."],
    deps = [
        ":actions",
        ":inputs",
        ":logging_context",
        "@pypi//platformdirs",
        "@pypi//pyyaml",
        "@pypi//types_pyyaml",
    ],
)

py_library(
    name = "precommit_autofix",
    srcs = ["precommit_autofix.py"],
    imports = [".."],
    visibility = ["//visibility:public"],
    deps = [
        ":actions",
        ":base",
        ":config",
        ":inputs",
        ":logging_context",
        ":tool_models",
        "@pypi//platformdirs",
        "@pypi//pygit2",
    ],
)

py_binary(
    name = "claude-autofixer",
    srcs = ["precommit_autofix.py"],
    imports = [".."],
    main = "precommit_autofix.py",
    deps = [
        ":actions",
        ":base",
        ":config",
        ":inputs",
        ":logging_context",
        ":tool_models",
        "@pypi//platformdirs",
        "@pypi//pygit2",
    ],
)

# =============================================================================
# Test support
# =============================================================================

py_library(
    name = "test_helpers",
    testonly = True,
    srcs = ["test_helpers.py"],
    imports = [".."],
    deps = [":inputs"],
)

py_library(
    name = "conftest",
    testonly = True,
    srcs = ["conftest.py"],
    data = glob(["testdata/**"]),
    imports = [".."],
    deps = [
        ":config",
        ":inputs",
        ":precommit_autofix",
        ":tool_models",
        "@pypi//pygit2",
        "@pypi//pytest",
        "@pypi//pyyaml",
        "@pypi//types_pyyaml",
    ],
)

# =============================================================================
# Tests (per-file)
# =============================================================================

py_test(
    name = "test_autofixer",
    srcs = ["test_autofixer.py"],
    imports = [".."],
    deps = [
        ":actions",
        ":config",
        ":conftest",
        ":precommit_autofix",
        ":tool_models",
        "@pypi//pyhamcrest",
        "@pypi//pytest",
        "@pypi//pytest_bazel",
    ],
)

py_test(
    name = "test_helpers_test",
    srcs = ["test_helpers.py"],
    imports = [".."],
    main = "test_helpers.py",
    deps = [
        ":inputs",
        "@pypi//pytest_bazel",
    ],
)

py_test(
    name = "test_input_parsing",
    srcs = ["test_input_parsing.py"],
    data = glob(["testdata/**"]),
    imports = [".."],
    deps = [
        ":conftest",
        ":test_helpers",
        ":tool_models",
        "@pypi//pytest",
        "@pypi//pytest_bazel",
    ],
)

py_test(
    name = "test_integration",
    srcs = ["test_integration.py"],
    imports = [".."],
    deps = [
        ":actions",
        ":conftest",
        ":precommit_autofix",
        "@pypi//pytest",
        "@pypi//pytest_bazel",
    ],
)

py_test(
    name = "test_models",
    srcs = ["test_models.py"],
    imports = [".."],
    deps = [
        ":conftest",
        ":inputs",
        ":tool_models",
        "@pypi//pydantic",
        "@pypi//pyhamcrest",
        "@pypi//pytest",
        "@pypi//pytest_bazel",
    ],
)

py_test(
    name = "test_precommit_integration",
    srcs = ["test_precommit_integration.py"],
    imports = [".."],
    deps = [
        ":actions",
        ":conftest",
        ":inputs",
        ":precommit_autofix",
        ":tool_models",
        "@pypi//pytest",
        "@pypi//pytest_bazel",
    ],
)

py_test(
    name = "test_precommit_syntax_check",
    srcs = ["test_precommit_syntax_check.py"],
    imports = [".."],
    deps = [
        ":actions",
        ":conftest",
        ":inputs",
        ":precommit_autofix",
        ":tool_models",
        "@pypi//pytest_bazel",
    ],
)

py_test(
    name = "test_protocol_actions",
    srcs = ["test_protocol_actions.py"],
    imports = [".."],
    deps = [
        ":actions",
        ":conftest",
        "@pypi//pytest_bazel",
    ],
)

# =============================================================================
# Lint
# =============================================================================
