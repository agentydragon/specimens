load("@rules_oci//oci:defs.bzl", "oci_image", "oci_load")
load("@rules_pkg//pkg:tar.bzl", "pkg_tar")

# Gazelle manages llm_html/ subpackage

# --- OCI Image ---

pkg_tar(
    name = "server_tar",
    srcs = ["//llm/html/llm_html:server"],
    include_runfiles = True,
    package_dir = "/app",
    strip_prefix = ".",
)

oci_image(
    name = "image",
    base = "@python_slim_linux_amd64",
    entrypoint = ["/app/server"],
    env = {
        "PYTHONDONTWRITEBYTECODE": "1",
        "PYTHONUNBUFFERED": "1",
    },
    exposed_ports = ["9000/tcp"],
    tars = [":server_tar"],
    workdir = "/app",
)

oci_load(
    name = "load",
    image = ":image",
    repo_tags = ["llm-html:latest"],
)
