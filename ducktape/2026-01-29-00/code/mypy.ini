[mypy]
python_version = 3.13
# Warn about functions returning Any when declared to return more specific types
warn_return_any = True
# Warn about unused # type: ignore comments
warn_unused_ignores = True
ignore_missing_imports = False
namespace_packages = True
explicit_package_bases = True
warn_unused_configs = True
disallow_untyped_defs = False
check_untyped_defs = True
# Only report errors in explicitly passed files, not transitively checked modules
# This still TYPE-CHECKS our usage of imported APIs, just doesn't report
# internal implementation errors within those packages
follow_imports = silent

# Source paths for workspace packages (used for non-Bazel runs)
# Bazel's rules_mypy sets MYPYPATH automatically from target deps
mypy_path = .

# Pydantic plugin for proper type understanding of Field() defaults and aliases
# SQLAlchemy plugin for proper ORM type inference
plugins = pydantic.mypy, sqlalchemy.ext.mypy.plugin

# Exclude only test fixtures and testdata within packages
# Also exclude Alembic migrations (auto-generated boilerplate)
# statsmodels is excluded because it has a broken module structure that causes
# mypy to error with "Source file found twice under different module names"
exclude = /third_party/|/testdata/|/fixtures/|/vendor/|/migrations/|tana/export/references/|/statsmodels/

# Per-module overrides for test data
[mypy-tests.agent.testdata.approval_policy.*]
ignore_errors = True

[mypy-*.testdata.*]
ignore_errors = True

[mypy-third_party.*]
ignore_errors = True

# Packages WITHOUT py.typed that have no stubs
[mypy-typer_di.*]
ignore_missing_imports = True

[mypy-compact_json.*]
ignore_missing_imports = True

# PyHamcrest has py.typed but its type annotations are broken - functions like
# all_of() and only_contains() use Union[Matcher[T], T] which mypy can't infer,
# defaulting to Matcher[Never]. Skip analysis to treat as Any.
# TODO: Remove once https://github.com/hamcrest/PyHamcrest/pull/267 is released
[mypy-hamcrest.*]
follow_imports = skip
ignore_missing_imports = True

# reaktiv has type hints but no py.typed marker file
[mypy-reaktiv.*]
ignore_missing_imports = True

# pytimeparse has no type stubs
[mypy-pytimeparse.*]
ignore_missing_imports = True

# rpds-py has broken stubs (implicit optional issues in __init__.pyi)
[mypy-rpds.*]
ignore_errors = True

# pygit2 stubs reference internal FFI module without stubs
[mypy-pygit2._libgit2.ffi]
ignore_missing_imports = True

# types-requests stubs import urllib3 which may not be on MYPYPATH for all targets
[mypy-urllib3.*]
ignore_missing_imports = True

# gnucash has no type stubs
[mypy-gnucash.*]
ignore_missing_imports = True

# gepa is a prompt optimization library without type stubs
[mypy-gepa.*]
ignore_missing_imports = True

# litellm has no type stubs
[mypy-litellm.*]
ignore_missing_imports = True

# inventree has no type stubs
[mypy-inventree.*]
ignore_missing_imports = True

# Legacy inventree import script - uses duck typing not compatible with strict mypy
[mypy-import_samplebooks2]
ignore_errors = True

# absl-py stubs have unused type: ignore comments
[mypy-absl.*]
ignore_errors = True

# Experimental cotrl package - unfinished RL experiment
[mypy-experimental.cotrl.*]
ignore_errors = True

# numpy bundled stubs have internal override/overload conflicts
[mypy-numpy.*]
ignore_errors = True

# aiodocker has no type stubs
[mypy-aiodocker.*]
ignore_missing_imports = True

# docker-py library stubs trigger import-untyped errors and have unused ignore comments
[mypy-docker.*]
ignore_missing_imports = True
ignore_errors = True

# psutil has no type stubs
[mypy-psutil.*]
ignore_missing_imports = True

# playwright has no type stubs
[mypy-playwright.*]
ignore_missing_imports = True

# statsmodels has broken __init__.py (seen as dual module names)
[mypy-statsmodels.*]
ignore_errors = True

# scipy stubs have unused type: ignore comments
[mypy-scipy.*]
ignore_errors = True

# google-api-python-client has no type stubs
[mypy-googleapiclient.*]
ignore_missing_imports = True

# google.oauth2 and google.auth have no type stubs
[mypy-google.oauth2.*]
ignore_missing_imports = True

[mypy-google.auth.*]
ignore_missing_imports = True

# pyzmq stubs have import errors and unused ignores
[mypy-zmq.*]
ignore_errors = True

# matplotlib bundled stubs have unused type: ignore comments
[mypy-matplotlib.*]
ignore_errors = True

# pandas bundled stubs have zero-member enum issues
[mypy-pandas.*]
ignore_errors = True

# gatelet needs SQLAlchemy ORM type annotation refactoring
# TODO: Add Mapped[] annotations to models and fix Column type narrowing
[mypy-gatelet.*]
ignore_errors = True

# mautrix bundled stubs have type issues (external library)
[mypy-mautrix.*]
ignore_errors = True

# jupyter_client has no type stubs
[mypy-jupyter_client.*]
ignore_missing_imports = True

# Test-local marker modules (pytest markers shared within test directories)
[mypy-_markers]
ignore_missing_imports = True

# rules_python runfiles module (Bazel-provided, no stubs)
[mypy-rules_python.*]
ignore_missing_imports = True

# props tests have complex relative conftest imports not resolvable by mypy
[mypy-props.core.tests.*]
ignore_errors = True

# tokenizers bundled stubs have duplicate class definitions
[mypy-tokenizers.*]
ignore_errors = True

# Testing packages
# Note: Most modern testing packages (pytest, httpx) have py.typed and don't need ignores

# MCP packages
# mcp: No py.typed marker - needs ignore (fastmcp has py.typed, so it's fine)
[mypy-mcp.*]
ignore_missing_imports = True

# CLI/UI packages with types
# Note: click has both py.typed AND types-click available
# Other packages (typer, rich) have py.typed

# Misc utilities
# Note: Modern packages (platformdirs, structlog, anyio, uvicorn) all have py.typed
# python-dotenv has py.typed as well
