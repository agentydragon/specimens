# Inherit workspace from parent
source_up

# Generate PostgreSQL password if not exists
PASSWORD_FILE=".direnv/pg_password"
mkdir -p .direnv
if [[ ! -f "$PASSWORD_FILE" ]]; then
  openssl rand -base64 24 > "$PASSWORD_FILE"
  chmod 600 "$PASSWORD_FILE"
fi

# PostgreSQL client variables (host-side access to Docker container)
export PGHOST="127.0.0.1"
export PGPORT="5433"
export PGUSER="postgres"
export PGDATABASE="eval_results"
export PGPASSWORD=$(cat "$PASSWORD_FILE")

# Container networking (for Docker Compose and agent containers)
export PROPS_DB_CONTAINER_NAME="props-postgres"
export PROPS_DB_CONTAINER_PORT="5432"

# OCI Registry configuration
export PROPS_REGISTRY_HOST="127.0.0.1"
export PROPS_REGISTRY_PORT="5000"  # Direct registry port (internal use)
export PROPS_REGISTRY_CONTAINER_NAME="props-registry"
export PROPS_REGISTRY_CONTAINER_PORT="5000"

# Backend serves as the unified proxy (LLM + Registry) on port 8000
# - LLM proxy: POST /v1/responses
# - Registry proxy: /v2/*
export PROPS_PROXY_HOST="127.0.0.1"
export PROPS_PROXY_PORT="8000"
export PROPS_PROXY_CONTAINER_NAME="props-backend"
export PROPS_PROXY_CONTAINER_PORT="8000"

# LLM Proxy URL (used by agents - points to backend container)
export PROPS_LLM_PROXY_URL="http://props-backend:8000"

# Specimens data directory
REPO_ROOT=$(git rev-parse --show-toplevel)
export ADGN_PROPS_SPECIMENS_ROOT="$REPO_ROOT/../specimens"
