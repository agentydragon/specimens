rationale: |
  `approve_policy_proposal` does not verify that the proposal status is
  'pending' before approving. The UPDATE on line 336 unconditionally sets
  `status = 'approved'` with no `WHERE status = 'pending'` guard. Combined
  with the caller `PolicyEngine.approve_proposal` (engine.py line 690) only
  checking for existence (`got is None`), an already-rejected or
  already-approved proposal can be re-approved, inserting a duplicate policy
  version into `approval_policies` and overwriting the rejection decision.
  The same missing guard exists in `reject_policy_proposal` (line 347).

should_flag: true

occurrences:
  - occurrence_id: occ-0
    files:
      agent_server/persist/sqlite.py:
        - [335, 337]  # UPDATE without WHERE status = 'pending'
      agent_server/mcp/approval_policy/engine.py:
        - [690, 692]  # only checks existence, not status
    note: "approve path: no guard against re-approving rejected/decided proposals"
    critic_scopes_expected_to_recall:
      - [agent_server/persist/sqlite.py]
      - [agent_server/mcp/approval_policy/engine.py]

  - occurrence_id: occ-1
    files:
      agent_server/persist/sqlite.py:
        - [346, 348]  # reject also has no status guard
    note: "reject path: same missing guard (can re-reject an approved proposal)"
    critic_scopes_expected_to_recall:
      - [agent_server/persist/sqlite.py]
