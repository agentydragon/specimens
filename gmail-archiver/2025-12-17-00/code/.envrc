# direnv + devenv (cached) â€” gmail-archiver environment setup
# Note: NOT using source_up to avoid parent flake issues on virtiofs
# Load parent's nix packages directly
use nix -p pre-commit

# Load devenv's direnv integration (provides caching + helpers)
eval "$(devenv direnvrc)"

# Trigger rebuilds only when dependency definitions change
watch_file pyproject.toml devenv.nix

# Activate the devenv-managed uv environment
use devenv

# Activate the devenv-managed venv on PATH so python/pytest/etc. are available
export VIRTUAL_ENV="$PWD/.devenv/state/venv"
PATH_add "$VIRTUAL_ENV/bin"

# direnv shim wrappers (fallbacks; venv bin takes precedence)
PATH_add .direnv/bin
